@model List<DistributionSchedule>
@using Cloud_Assignment.Areas.Identity.Data
@using Microsoft.AspNetCore.Identity
@inject UserManager<Cloud_AssignmentUser> UserManager
@{
    ViewData["Title"] = "ViewScheduleRecord";
    var UserAccount = await UserManager.GetUserAsync(User);
}

<button onclick="Back()">Back</button>
<center>
    <h1>Distribution Schedule Record Management</h1>
    <table border="1">
        <tr style="background-color: yellow;">
            <th>Distribution ID</th>
            <th>Record Type</th>
            <th>Record ID</th>
            <th>Distribution Status</th>
            <th>Date of Delivery</th>
            <th>Distributor Name</th>
            <th>Function</th>
        </tr>
        @foreach (var item in Model)
        {
            var user = await UserManager.FindByIdAsync(@item.DistributorId!);

            <tr>
                <td>@item.DistributionId</td>
                <td>@item.RecordType</td>
                <td>@item.RecordId</td>
                <td>@item.DistributionStatus</td>
                <td>@item.DOD</td>
                <td>@item.Distributor?.UserFullName</td>
                @if (UserAccount != null && UserAccount.Id == @item.DistributorId!)
                {
                    <form asp-action="EditDistributionScheduleRecord" asp-controller="DistributionScheduleRecord" asp-route-DistributionId="@item.DistributionId">
                    <td><button>Edit</button></td>
                    </form>
                    <form asp-action="DeleteDistributionRecord" asp-controller="DistributionScheduleRecord" asp-route-DistributionId="@item.DistributionId" 
                    onsubmit="return confirm('Are you confirm you want to delete this record?');">
                    <td><button>Delete</button></td>
                    </form>
                }
            </tr>
        }
    </table>
</center>

<script>
    function Back() {
        var previousPage = '@(Context.Request.Headers["Referer"].ToString())';
        window.location.href = previousPage;
    }
</script>

